names(misc)[2]="Value"
fnb$Relevant_Date <- as.Date(fnb$Relevant_Date)
pnt$Relevant_Date <- as.Date(pnt$Relevant_Date)
cnf$Relevant_Date <- as.Date(cnf$Relevant_Date)
housing$Relevant_Date <- as.Date(housing$Relevant_Date)
fnl$Relevant_Date <- as.Date(fnl$Relevant_Date)
misc$Relevant_Date <- as.Date(misc$Relevant_Date)
# Get the last four months of data for each variable
fnb_last_four <- fnb[fnb$Relevant_Date >= Sys.Date() - 120, ]
pnt_last_four <- pnt[pnt$Relevant_Date >= Sys.Date() - 120, ]
cnf_last_four <- cnf[cnf$Relevant_Date >= Sys.Date() - 120, ]
housing_last_four <- housing[housing$Relevant_Date >= Sys.Date() - 120, ]
fnl_last_four <- fnl[fnl$Relevant_Date >= Sys.Date() - 120, ]
misc_last_four <- misc[misc$Relevant_Date >= Sys.Date() - 120, ]
fnb_last_four$Variable <- paste0("Food and beverages")
pnt_last_four$Variable <- paste0("Pan, tobacco and","\n"," intoxicants")
cnf_last_four$Variable <- paste0("Clothing and footwear")
housing_last_four$Variable <- paste0("Housing")
fnl_last_four$Variable <- paste0("Fuel and light")
misc_last_four$Variable <- paste0("Miscellaneous")
construct_date_label <- function(date) {
year <- year(date)
month_names <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
month_name <- month_names[month(date)]
return(paste("Inflation Rate - ",month_name,'-', substr(year, 3, 4), sep = " "))
}
combined_data <- bind_rows(fnb_last_four, pnt_last_four, cnf_last_four,
housing_last_four, fnl_last_four, misc_last_four)
combined_data_cpi<-combined_data
combined_data$Relevant_Date <- construct_date_label(combined_data$Relevant_Date)
my_legends_col=c("#4474c4","#ec7c35","#a4a4a4","#fcc405")
custom_order <- c("Food and beverages",
"Pan, tobacco and\n intoxicants",
"Clothing and footwear",
"Housing",
"Fuel and light",
"Miscellaneous")
# Apply the custom order to the Variable column
combined_data$Variable <- factor(combined_data$Variable, levels = custom_order)
custom_order <- c("Inflation Rate -  Dec - 23",
"Inflation Rate -  Jan - 24",
"Inflation Rate -  Feb - 24",
"Inflation Rate -  Mar - 24")
combined_data$Relevant_Date <- factor(combined_data$Relevant_Date, levels = custom_order)
cpi= data_query_clk_pg(id=1300430,period = 300)[1][[1]]
cpi_source=data_query_clk_pg(id=1300430,period = 300)[2][[1]]
names(cpi)[1]="Relevant_Date"
names(cpi)[2]="Value"
clk  <- DBI::dbConnect(RClickhouse::clickhouse(), dbname =DB_cl,host = host_cl,
port = port_cl,user = user_cl,password =password_cl)
cpi_table_query = "select Group_Name as Variable,Weight_Value as Weight from PIB_MOSPI_ALL_INDIA_GROUP_SUB_GROUP_WISE_CPI_MONTHLY_INDEX
where Description in ('Food and beverages','Pan, tobacco and intoxicants',
'Clothing and footwear','Housing','Fuel and light','Miscellaneous') and  Type='Combined'
AND Relevant_Date ='2023-12-31'"
cpi_weight = dbGetQuery(clk,cpi_table_query)
cpi_last_four <- cpi
cpi_last_four$Variable <- paste0("CPI")
# Apply the function to each dataframe
cpi_value_one_year_ago <- extract_value_one_year_ago(cpi_last_four)
relevant_date_df <- data.frame(
Variable = c("CPI_21"),
Value = c(cpi_value_one_year_ago)
)
cpi_last_year <- cpi[cpi$Relevant_Date >= Sys.Date() - 30, ]
cpi_last_year$Variable <- paste0("CPI_24")
cpi_last_year <- cpi_last_year[, c("Value", "Variable")]
combined_data <- bind_rows(relevant_date_df,cpi_last_year)
cpi_23 <- combined_data[combined_data$Variable == "CPI_21", "Value"]
cpi_24 <- combined_data[combined_data$Variable == "CPI_24", "Value"]
# Calculate the difference
value_difference <- cpi_24 - cpi_23
cpi_weight$Value<-cpi_weight$Weight*value_difference/100
cpi_weight<-subset(cpi_weight,select=-Weight)
combined_data <- bind_rows(combined_data,cpi_weight)
# Format the Relevant_Date column as string
combined_data$Relevant_Date <- 'Mar 23'
combined_data <- combined_data %>%
rename(x.axis.Var = Variable, values = Value, cat.Var = Relevant_Date)
df<-combined_data
category_names <- c("CPI Mar 21", "CPI Mar 24", "Food and \nbeverages", "Pan, tobacco and \nintoxicants",
"Clothing and footwear", "Housing", "Fuel and light",
"Miscellaneous")
df$x.axis.Var <- c("CPI Mar 21", "CPI Mar 24", "Food and \nbeverages",
"Pan, tobacco and \nintoxicants", "Clothing and footwear",
"Housing", "Fuel and light", "Miscellaneous")
df.tmp <- df %>%
mutate(
x.axis.Var = factor(x.axis.Var,
levels = c("CPI Mar 21","Food and \nbeverages",
"Pan, tobacco and \nintoxicants",
"Clothing and footwear",
"Housing",
"Fuel and light",
"Miscellaneous","CPI Mar 24")),
cat.Var = factor(cat.Var,
levels = c("Mar 23"))
) %>%
arrange(x.axis.Var, desc(cat.Var)) %>%
mutate(end.Bar = cumsum(values),
start.Bar = c(0, head(end.Bar, -1))) %>%
rbind(
df %>%
group_by(cat.Var) %>%
summarise(values = sum(values)) %>%
mutate(
x.axis.Var = "Total",
cat.Var = factor(cat.Var,
levels = c("Mar 23"))
) %>%
arrange(x.axis.Var, desc(cat.Var)) %>%
mutate(end.Bar = cumsum(values),
start.Bar = c(0, head(end.Bar, -1))) %>%
select(names(df),end.Bar,start.Bar)
) %>%
mutate(group.id = group_indices(., x.axis.Var)) %>%
group_by(x.axis.Var) %>%
mutate(total.by.x = sum(values)) %>%
select(x.axis.Var, cat.Var, group.id, start.Bar, values, end.Bar, total.by.x)
df.tmp <- data.frame(df.tmp)
df.tmp <- df.tmp[df.tmp$x.axis.Var != "Total", ]
df.tmp$start.Bar[df.tmp$x.axis.Var == "CPI Mar 24"] <- 0
df.tmp$end.Bar[df.tmp$x.axis.Var == "CPI Mar 24"] <- 185.80
df.tmp$label <- roundexcel(df.tmp$end.Bar - df.tmp$start.Bar,2)
# Replace numerical values with corresponding category names
df.tmp
font_size=10
font_size_axis=9
water_fall_chart<-ggplot(df.tmp, aes( x = str_wrap(x.axis.Var, width = 10), fill = cat.Var)) +
# Waterfall Chart
geom_rect(aes(x = x.axis.Var,
xmin = group.id - 0.25, # control bar gap width
xmax = group.id + 0.25,
ymin = end.Bar,
ymax = start.Bar,
fill = ifelse(x.axis.Var == "CPI Mar 23", "white",
ifelse(x.axis.Var == "CPI Mar 24", "black",
ifelse(values >= 0, "green", "red"))))
) +
geom_text(aes(x = x.axis.Var, y = start.Bar + label , label = label),
size = 3, color = "black", hjust = 0.5, vjust = -0.5)+
coord_cartesian(ylim = c(120, 190))+
theme(legend.position = "none")+
common_theme(Position = 'center') +
geom_hline(yintercept = 0, color = "black", linetype = "solid", size = 0.5) +
theme(
plot.margin = margin(0.5, 0, 0, 0, "cm"),
axis.text.x = element_text(angle = 0, vjust = 0.5, hjust = 0.85, size = font_size_axis,  family = "Times New Roman"),
axis.text.y.left = element_text(size = font_size_axis-1, margin = margin(r = 1),  family = "Times New Roman"),
axis.text.y.right = element_text(size = font_size_axis-1, margin = margin(r = 1),  family = "Times New Roman"),
plot.title = element_text(color = "black", size = font_size, face = "bold", vjust = 0.5, hjust = 0.5, family = "Times New Roman"),
legend.position = "none",
legend.key.spacing.y = unit(0.1, 'cm'),
legend.key.spacing.x = unit(0.5, 'cm'),
legend.justification = "center"
)+ylab('') +labs(title = 'CPI')+
light_house_theme() +
LH_common_theme()+
theme(legend.position = "none")
#############################iip other goods slide###################################
my_ppt=add_slide(my_ppt,layout ="1_chart_ajim",master ="Ajim_Premji" ) %>%
ph_with(value ='CPI',location=ph_location_type(type ="title")) %>%
ph_with(value =water_fall_chart, location =ph_location_type(type ="chart",id=1))%>%
ph_with(value =cpi_source, location =ph_location_type(type ="body",id=1))
print(my_ppt,target="D:\\Ajim_Premji\\ajim_premji\\ajim_premji_output_files\\ajim_primji1.pptx")
fnb= data_query_clk_pg(id=726007,period = 300)[1][[1]]
fnb_source=data_query_clk_pg(id=726007,period = 300)[2][[1]]
names(fnb)[1]="Relevant_Date"
names(fnb)[2]="Value"
pnt= data_query_clk_pg(id=726029,period = 300)[1][[1]]
names(pnt)[1]="Relevant_Date"
names(pnt)[2]="Value"
cnf= data_query_clk_pg(id=725998,period = 300)[1][[1]]
names(cnf)[1]="Relevant_Date"
names(cnf)[2]="Value"
housing= data_query_clk_pg(id=726015,period = 300)[1][[1]]
names(housing)[1]="Relevant_Date"
names(housing)[2]="Value"
fnl= data_query_clk_pg(id=726010,period = 300)[1][[1]]
names(fnl)[1]="Relevant_Date"
names(fnl)[2]="Value"
misc= data_query_clk_pg(id=726021,period = 300)[1][[1]]
names(misc)[1]="Relevant_Date"
names(misc)[2]="Value"
fnb$Relevant_Date <- as.Date(fnb$Relevant_Date)
pnt$Relevant_Date <- as.Date(pnt$Relevant_Date)
cnf$Relevant_Date <- as.Date(cnf$Relevant_Date)
housing$Relevant_Date <- as.Date(housing$Relevant_Date)
fnl$Relevant_Date <- as.Date(fnl$Relevant_Date)
misc$Relevant_Date <- as.Date(misc$Relevant_Date)
# Get the last four months of data for each variable
fnb_last_four <- fnb[fnb$Relevant_Date >= Sys.Date() - 120, ]
pnt_last_four <- pnt[pnt$Relevant_Date >= Sys.Date() - 120, ]
cnf_last_four <- cnf[cnf$Relevant_Date >= Sys.Date() - 120, ]
housing_last_four <- housing[housing$Relevant_Date >= Sys.Date() - 120, ]
fnl_last_four <- fnl[fnl$Relevant_Date >= Sys.Date() - 120, ]
misc_last_four <- misc[misc$Relevant_Date >= Sys.Date() - 120, ]
fnb_last_four$Variable <- paste0("Food and beverages")
pnt_last_four$Variable <- paste0("Pan, tobacco and","\n"," intoxicants")
cnf_last_four$Variable <- paste0("Clothing and footwear")
housing_last_four$Variable <- paste0("Housing")
fnl_last_four$Variable <- paste0("Fuel and light")
misc_last_four$Variable <- paste0("Miscellaneous")
construct_date_label <- function(date) {
year <- year(date)
month_names <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
month_name <- month_names[month(date)]
return(paste("Inflation Rate - ",month_name,'-', substr(year, 3, 4), sep = " "))
}
combined_data <- bind_rows(fnb_last_four, pnt_last_four, cnf_last_four,
housing_last_four, fnl_last_four, misc_last_four)
combined_data_cpi<-combined_data
combined_data$Relevant_Date <- construct_date_label(combined_data$Relevant_Date)
my_legends_col=c("#4474c4","#ec7c35","#a4a4a4","#fcc405")
custom_order <- c("Food and beverages",
"Pan, tobacco and\n intoxicants",
"Clothing and footwear",
"Housing",
"Fuel and light",
"Miscellaneous")
# Apply the custom order to the Variable column
combined_data$Variable <- factor(combined_data$Variable, levels = custom_order)
combined_data_1<-combined_data
custom_order <- c("Inflation Rate -  Dec - 23",
"Inflation Rate -  Jan - 24",
"Inflation Rate -  Feb - 24",
"Inflation Rate -  Mar - 24")
combined_data$Relevant_Date <- factor(combined_data$Relevant_Date, levels = custom_order)
####################################Cpi attributes##################################
combined_data_cpi <- combined_data_cpi %>%
mutate(Variable = ifelse(Variable == "Pan, tobacco and\n intoxicants", "Pan, tobacco and intoxicants", Variable))
combined_data_cpi$s_no<-seq_len(nrow(combined_data_cpi))
clk  <- DBI::dbConnect(RClickhouse::clickhouse(), dbname =DB_cl,host = host_cl,
port = port_cl,user = user_cl,password =password_cl)
cpi_query = "select Description as Variable,Weight_Value,Relevant_Date from PIB_MOSPI_ALL_INDIA_GROUP_SUB_GROUP_WISE_CPI_MONTHLY_INDEX
where Description in ('Clothing and footwear','Miscellaneous','Food and beverages',
'Pan, tobacco and intoxicants','Housing','Fuel and light') and Type='Combined'
AND Relevant_Date >= toDate(today() - 120)"
cpi = dbGetQuery(clk,cpi_query)
merged_data_cpi <- merge(combined_data_cpi, cpi, by = c("Variable", "Relevant_Date"), all.x = TRUE)
# Calculate the new Value column
merged_data_cpi$Value <- (merged_data_cpi$Value * merged_data_cpi$Weight_Value) / 100
merged_data_cpi<- subset(merged_data_cpi,select=-Weight_Value)
cpi_data <- merged_data_cpi %>%
group_by(Relevant_Date) %>%
summarise(CPI = sum(Value)) %>%
mutate(Variable = "CPI")
# Convert cpi_data to a dataframe
cpi_data <- as.data.frame(cpi_data)
names(cpi_data)[2]="Value"
names(cpi_data)[3]="Variable"
# Combine merged_data with cpi_data
combined_data <- rbind(merged_data_cpi)
combined_data <- combined_data %>%
arrange(desc(Value))
# Print the combined dataframe
variable_order <- c("Food and beverages", "Pan, tobacco and intoxicants", "Clothing and footwear",
"Housing", "Fuel and light", "Miscellaneous")
reversed_order <- rev(variable_order)
# Convert the Variable column to a factor with the desired order of levels
combined_data$Variable <- factor(combined_data$Variable, levels = reversed_order)
combined_data <- combined_data %>%
arrange(s_no)
combined_data=subset(combined_data,select=-s_no)
print(combined_data)
my_legends_col=c(
"Food and beverages"="#6489bd",
"Pan, tobacco and intoxicants"="#e88f55",
"Clothing and footwear"="#a5a5a5",
"Housing"="#f8b90d",
"Fuel and light"="purple",
"Miscellaneous"="#73ac44"
)
combined_data
data_final <- transform(combined_data, cumsum = ave(Value, Relevant_Date, FUN = cumsum))
data_final <- combined_data
# line <- ggplot(data = data_final,
#                aes(x = Relevant_Date, y = Value, fill = Variable)) +
#   geom_bar(stat = "identity", width = 10) +
#   geom_text_repel(label = round(data_final$Value, digits = 1),
#                   position = position_stack(vjust = 0),
#                   max.overlaps = 10, direction = "y", font = "bold",
#                   family = "Times New Roman", size = 3, hjust = 0.5, vjust = 0) + # Adjusted hjust to 0.5
#   scale_x_date(breaks = data_final$Relevant_Date,
#                labels = scales::date_format("%b-%y"), # Updated to scales::date_format
#                expand = c(0.1, 0.1)) +
#   coord_cartesian(ylim = c(0, 6))
# line <- ggplot(data = data_final,
#                aes(x = Relevant_Date, y = Value, fill = Variable)) +
#   geom_bar(stat = "identity", width = 10) +
#   geom_text_repel(aes(label = round(Value, digits = 1),
#                      y = cumsum(Value) - (Value / 2)), # Manually calculating position for centering vertically
#                   max.overlaps = 10, direction = "y", font = "bold",
#                   family = "Times New Roman", size = 3, hjust = 0.5, vjust = 0.5) +
#   scale_x_date(breaks = data_final$Relevant_Date,
#                labels = scales::date_format("%b-%y"),
#                expand = c(0.1, 0.1)) +
#   coord_cartesian(ylim = c(0, 8))
line <- ggplot(data = data_final,
aes(x = Relevant_Date, y = Value, fill = Variable)) +
geom_bar(stat = "identity", width = 10) +
geom_text_repel(data = transform(data_final,
middle_pos = ifelse(Value >= 0, round(ave(Value, Relevant_Date, FUN = cumsum) - (Value / 2) - 0.05, digits = 4), NA),
middle_neg = Value),
aes(label = round(Value, digits = 1),
y = ifelse(Value >= 0, middle_pos, middle_neg)),
max.overlaps = 10, direction = "y", font = "bold",
family = "Times New Roman", size = 2.8) +
scale_x_date(breaks = data_final$Relevant_Date,
labels = scales::date_format("%b-%y"),
expand = c(0.1, 0.1))
line
#############################cpi sttribuutes###################################
my_ppt=add_slide(my_ppt,layout ="1_chart_ajim",master ="Ajim_Premji" ) %>%
ph_with(value ='CPI Attribute',location=ph_location_type(type ="title")) %>%
ph_with(value =line, location =ph_location_type(type ="chart",id=1))%>%
ph_with(value =fnb_source, location =ph_location_type(type ="body",id=1))
print(my_ppt,target="D:\\Ajim_Premji\\ajim_premji\\ajim_premji_output_files\\ajim_primji_test5.pptx")
setwd('D:\\Ajim_Premji\\ajim_premji\\Light_house_common_functions')
# Import the contents of theme.R
source("Theme.R")
# Import the contents of font.R
#source("font.R")
# Import the contents of ajim_premji_chart_generation.R
source("ajim_premji_Chart_Functions.R")
source("common_functions.R")
current_date <- Sys.Date()
current_date
current_date_t <- Sys.time()  # Get current date and time
formatted_date <- format(current_date_t, "%d_%m_%Y_%H_%M")  # Format the date and time
formatted_date
#file_name=paste0('C:\\Users\\Administrator\\AdQvestDir\\codes\\ajim_premji_PPT_CODES\\ajim_premji_output_files\\ajim_premji_',formatted_date,'.pptx')
file_name=paste0('D:\\Ajim_Premji\\ajim_premji\\ajim_premji_main_code\\ajim_premji_output_files\\ajim_premji_PPT.pptx')
############################CPI Components##############################
fnb= data_query_clk_pg(id=726007,period = 300)[1][[1]]
fnb_source=data_query_clk_pg(id=726007,period = 300)[2][[1]]
names(fnb)[1]="Relevant_Date"
names(fnb)[2]="Value"
pnt= data_query_clk_pg(id=726029,period = 300)[1][[1]]
names(pnt)[1]="Relevant_Date"
names(pnt)[2]="Value"
cnf= data_query_clk_pg(id=725998,period = 300)[1][[1]]
names(cnf)[1]="Relevant_Date"
names(cnf)[2]="Value"
housing= data_query_clk_pg(id=726015,period = 300)[1][[1]]
names(housing)[1]="Relevant_Date"
names(housing)[2]="Value"
fnl= data_query_clk_pg(id=726010,period = 300)[1][[1]]
names(fnl)[1]="Relevant_Date"
names(fnl)[2]="Value"
misc= data_query_clk_pg(id=726021,period = 300)[1][[1]]
names(misc)[1]="Relevant_Date"
names(misc)[2]="Value"
fnb$Relevant_Date <- as.Date(fnb$Relevant_Date)
pnt$Relevant_Date <- as.Date(pnt$Relevant_Date)
cnf$Relevant_Date <- as.Date(cnf$Relevant_Date)
housing$Relevant_Date <- as.Date(housing$Relevant_Date)
fnl$Relevant_Date <- as.Date(fnl$Relevant_Date)
misc$Relevant_Date <- as.Date(misc$Relevant_Date)
# Get the last four months of data for each variable
fnb_last_four <- fnb[fnb$Relevant_Date >= Sys.Date() - 120, ]
pnt_last_four <- pnt[pnt$Relevant_Date >= Sys.Date() - 120, ]
cnf_last_four <- cnf[cnf$Relevant_Date >= Sys.Date() - 120, ]
housing_last_four <- housing[housing$Relevant_Date >= Sys.Date() - 120, ]
fnl_last_four <- fnl[fnl$Relevant_Date >= Sys.Date() - 120, ]
misc_last_four <- misc[misc$Relevant_Date >= Sys.Date() - 120, ]
fnb_last_four$Variable <- paste0("Food and beverages")
pnt_last_four$Variable <- paste0("Pan, tobacco and","\n"," intoxicants")
cnf_last_four$Variable <- paste0("Clothing and footwear")
housing_last_four$Variable <- paste0("Housing")
fnl_last_four$Variable <- paste0("Fuel and light")
misc_last_four$Variable <- paste0("Miscellaneous")
construct_date_label <- function(date) {
year <- year(date)
month_names <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
month_name <- month_names[month(date)]
return(paste("Inflation Rate - ",month_name,'-', substr(year, 3, 4), sep = " "))
}
combined_data <- bind_rows(fnb_last_four, pnt_last_four, cnf_last_four,
housing_last_four, fnl_last_four, misc_last_four)
combined_data_cpi<-combined_data
combined_data$Relevant_Date <- construct_date_label(combined_data$Relevant_Date)
my_legends_col=c("#4474c4","#ec7c35","#a4a4a4","#fcc405")
custom_order <- c("Food and beverages",
"Pan, tobacco and\n intoxicants",
"Clothing and footwear",
"Housing",
"Fuel and light",
"Miscellaneous")
# Apply the custom order to the Variable column
combined_data$Variable <- factor(combined_data$Variable, levels = custom_order)
combined_data_1<-combined_data
custom_order <- c("Inflation Rate -  Dec - 23",
"Inflation Rate -  Jan - 24",
"Inflation Rate -  Feb - 24",
"Inflation Rate -  Mar - 24")
combined_data$Relevant_Date <- factor(combined_data$Relevant_Date, levels = custom_order)
####################################Cpi attributes##################################
combined_data_cpi <- combined_data_cpi %>%
mutate(Variable = ifelse(Variable == "Pan, tobacco and\n intoxicants", "Pan, tobacco and intoxicants", Variable))
combined_data_cpi$s_no<-seq_len(nrow(combined_data_cpi))
clk  <- DBI::dbConnect(RClickhouse::clickhouse(), dbname =DB_cl,host = host_cl,
port = port_cl,user = user_cl,password =password_cl)
cpi_query = "select Description as Variable,Weight_Value,Relevant_Date from PIB_MOSPI_ALL_INDIA_GROUP_SUB_GROUP_WISE_CPI_MONTHLY_INDEX
where Description in ('Clothing and footwear','Miscellaneous','Food and beverages',
'Pan, tobacco and intoxicants','Housing','Fuel and light') and Type='Combined'
AND Relevant_Date >= toDate(today() - 120)"
cpi = dbGetQuery(clk,cpi_query)
merged_data_cpi <- merge(combined_data_cpi, cpi, by = c("Variable", "Relevant_Date"), all.x = TRUE)
# Calculate the new Value column
merged_data_cpi$Value <- (merged_data_cpi$Value * merged_data_cpi$Weight_Value) / 100
merged_data_cpi<- subset(merged_data_cpi,select=-Weight_Value)
cpi_data <- merged_data_cpi %>%
group_by(Relevant_Date) %>%
summarise(CPI = sum(Value)) %>%
mutate(Variable = "CPI")
# Convert cpi_data to a dataframe
cpi_data <- as.data.frame(cpi_data)
names(cpi_data)[2]="Value"
names(cpi_data)[3]="Variable"
# Combine merged_data with cpi_data
combined_data <- rbind(merged_data_cpi)
combined_data <- combined_data %>%
arrange(desc(Value))
# Print the combined dataframe
variable_order <- c("Food and beverages", "Pan, tobacco and intoxicants", "Clothing and footwear",
"Housing", "Fuel and light", "Miscellaneous")
reversed_order <- rev(variable_order)
# Convert the Variable column to a factor with the desired order of levels
combined_data$Variable <- factor(combined_data$Variable, levels = reversed_order)
combined_data <- combined_data %>%
arrange(s_no)
combined_data=subset(combined_data,select=-s_no)
print(combined_data)
my_legends_col=c(
"Food and beverages"="#6489bd",
"Pan, tobacco and intoxicants"="#e88f55",
"Clothing and footwear"="#a5a5a5",
"Housing"="#f8b90d",
"Fuel and light"="purple",
"Miscellaneous"="#73ac44"
)
combined_data
data_final <- transform(combined_data, cumsum = ave(Value, Relevant_Date, FUN = cumsum))
data_final <- combined_data
line <- ggplot(data = data_final,
aes(x = Relevant_Date, y = Value, fill = Variable)) +
geom_bar(stat = "identity", width = 10) +
geom_text_repel(data = transform(data_final,
middle_pos = ifelse(Value >= 0, round(ave(Value, Relevant_Date, FUN = cumsum) - (Value / 2) - 0.05, digits = 4), NA),
middle_neg = Value),
aes(label = round(Value, digits = 1),
y = ifelse(Value >= 0, middle_pos, middle_neg)),
max.overlaps = 10, direction = "y", font = "bold",
family = "Times New Roman", size = 2.8) +
scale_x_date(breaks = data_final$Relevant_Date,
labels = scales::date_format("%b-%y"),
expand = c(0.1, 0.1))
#############################cpi sttribuutes###################################
my_ppt=add_slide(my_ppt,layout ="1_chart_ajim",master ="Ajim_Premji" ) %>%
ph_with(value ='CPI Attribute',location=ph_location_type(type ="title")) %>%
ph_with(value =line, location =ph_location_type(type ="chart",id=1))%>%
ph_with(value =fnb_source, location =ph_location_type(type ="body",id=1))
print(my_ppt,target="D:\\Ajim_Premji\\ajim_premji\\ajim_premji_output_files\\ajim_primji_test5.pptx")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
middle_pos = ifelse(data_final$Value >= 0, round(ave(data_final$Value, Relevant_Date, FUN = cumsum) - (data_final$Value / 2) - 0.05, digits = 4), NA)
middle_pos = ifelse(data_final$Value >= 0, round(ave(data_final$Value, data_final$Relevant_Date, FUN = cumsum) - (data_final$Value / 2) - 0.05, digits = 4), NA)
middle_pos
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
library(ggplot2)
library(dplyr)
# Sample data
data <- data.frame(
category = rep(c("A", "B", "C"), each = 4),
subgroup = rep(c("X", "Y"), 6),
value = sample(-20:20, 12, replace = TRUE)
)
# Calculate cumulative sums for each category
data <- data %>%
group_by(category) %>%
mutate(abs_value = abs(value),
cum_value = cumsum(abs_value),
middle = cum_value - 0.5 * abs_value)
# Plot
ggplot(data, aes(fill = subgroup, y = value, x = category)) +
geom_bar(stat = "identity") +
geom_text(aes(label = value, y = middle), position = position_stack(vjust = 0.5)) +
labs(x = "Category", y = "Value", title = "Stacked Bar Chart with Data Labels") +
theme_minimal()
data <- data.frame(
category = rep(c("A", "B", "C"), each = 4),
subgroup = rep(c("X", "Y"), 6),
value = sample(1:20, 12, replace = TRUE)
)
# Calculate cumulative sums for each category
data <- data %>%
group_by(category) %>%
mutate(cum_value = cumsum(value),
middle = cum_value - 0.5 * value)
# Plot
ggplot(data, aes(fill = subgroup, y = value, x = category)) +
geom_bar(stat = "identity") +
geom_text(aes(label = value, y = middle), position = position_stack(vjust = 0.5)) +
labs(x = "Category", y = "Value", title = "Stacked Bar Chart with Data Labels") +
theme_minimal()
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
source("D:/Ajim_Premji/ajim_premji/Light_house_common_functions/bar_label_test.R")
